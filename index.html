<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>第三次机器人大战：命运轮回</title>

  <style>
    body {
      background: black;
      color: #0f0;
      font-family: monospace;
      padding: 20px;
    }

    h1, h2 {
      color: #0f0;
    }

    .status {
      margin-bottom: 10px;
    }

    button {
      background: #111;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 8px 16px;
      margin-right: 10px;
      cursor: pointer;
    }

    button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    #log {
      border: 1px solid #0f0;
      padding: 10px;
      margin-top: 15px;
      height: 260px;
      overflow-y: auto;
      white-space: pre-line;
    }
  </style>
</head>

<body>

<h1>第三次机器人大战：命运轮回</h1>
<h2>第一话：暗云</h2>

<div class="status">我方 HP：<span id="playerHP"></span></div>
<div class="status">敌方 HP：<span id="enemyHP"></span></div>

<div>
  <button id="attackBtn">攻击</button>
  <button id="defendBtn">防御</button>
  <button id="specialBtn">必杀</button>
  <button id="restartBtn" disabled>重新开始</button>
</div>

<div id="log"></div>

<script>
  // ====== 初始数值 ======
  const MAX_PLAYER_HP = 100;
  const MAX_ENEMY_HP = 80;

  let playerHP;
  let enemyHP;
  let battleOver = false;

  // ====== DOM ======
  const playerHPSpan = document.getElementById("playerHP");
  const enemyHPSpan = document.getElementById("enemyHP");
  const logDiv = document.getElementById("log");

  const attackBtn = document.getElementById("attackBtn");
  const defendBtn = document.getElementById("defendBtn");
  const specialBtn = document.getElementById("specialBtn");
  const restartBtn = document.getElementById("restartBtn");

  // ====== 工具函数 ======
  function rand(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function log(text) {
    logDiv.textContent += text + "\n";
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  function updateHP() {
    playerHPSpan.textContent = playerHP;
    enemyHPSpan.textContent = enemyHP;
  }

  function clampHP() {
    if (playerHP < 0) playerHP = 0;
    if (enemyHP < 0) enemyHP = 0;
  }

  function endBattle(message) {
    battleOver = true;
    log("★ " + message);
    attackBtn.disabled = true;
    defendBtn.disabled = true;
    specialBtn.disabled = true;
    restartBtn.disabled = false;
  }

  // ====== 敌方回合 ======
  function enemyTurn() {
    if (battleOver) return;

    const dmg = rand(8, 16);
    playerHP -= dmg;
    clampHP();
    log(`敌方攻击！造成 ${dmg} 点伤害`);

    if (playerHP <= 0) {
      endBattle("我方机体被击毁……战斗失败");
    }

    updateHP();
  }

  // ====== 玩家操作 ======
  attackBtn.onclick = () => {
    if (battleOver) return;

    const dmg = rand(12, 20);
    enemyHP -= dmg;
    clampHP();
    log(`我方攻击！造成 ${dmg} 点伤害`);

    if (enemyHP <= 0) {
      endBattle("敌机爆炸！战斗胜利！");
    } else {
      enemyTurn();
    }

    updateHP();
  };

  defendBtn.onclick = () => {
    if (battleOver) return;

    const dmg = rand(4, 8);
    playerHP -= dmg;
    clampHP();
    log(`我方防御姿态，仍受到 ${dmg} 点伤害`);

    if (playerHP <= 0) {
      endBattle("我方机体被击毁……战斗失败");
    }

    updateHP();
  };

  specialBtn.onclick = () => {
    if (battleOver) return;

    const dmg = rand(25, 35);
    enemyHP -= dmg;
    clampHP();
    log(`◆ 必杀技发动！造成 ${dmg} 点致命伤害！`);

    if (enemyHP <= 0) {
      endBattle("敌机被彻底摧毁！战斗胜利！");
    } else {
      enemyTurn();
    }

    updateHP();
  };

  restartBtn.onclick = startGame;

  // ====== 开始 / 重置 ======
  function startGame() {
    playerHP = MAX_PLAYER_HP;
    enemyHP = MAX_ENEMY_HP;
    battleOver = false;

    logDiv.textContent = "";
    log("战斗开始！");

    attackBtn.disabled = false;
    defendBtn.disabled = false;
    specialBtn.disabled = false;
    restartBtn.disabled = true;

    updateHP();
  }

  startGame();
</script>

</body>
</html>